(function(){var t,s,i,e,o,n,r,a,l=function(t,s){return function(){return t.apply(s,arguments)}};a=this;i=a.document;e=Number.isFinite||a.isFinite;o=function(t){return t.replace(/([.\\+*?\^\[\]$(){}])/g,"\\$1")};n=function(t,s){var i;i=0;return function(){var e;e=new Date;if(e-i<s){return}i=e;return t.apply(null,arguments)}};s=function(t,s,i){t.addEventListener(s,i,false)};r=function(t,s,i){t.removeEventListener(s,i,false)};t=function(){function t(t){this.saveWinOffset_=l(this.saveWinOffset_,this);this.validate_=l(this.validate_,this);this.destroyed_=true;this.images_=[];this.options_=t||{};this.options_.src=this.options_.src||"data-src";this.options_.srcset=this.options_.srcset||"data-srcset";if(!e(this.options_.offsetX)){this.options_.offsetX=100}if(!e(this.options_.offsetY)){this.options_.offsetY=100}this.options_.error=this.options_.error||false;this.options_.success=this.options_.success||false;this.options_.selector=this.options_.selector||".be-lazy";this.options_.errorClass=this.options_.errorClass||"be-error";this.options_.loadingClass=this.options_.loadingClass||"be-loading";this.options_.successClass=this.options_.successClass||"be-loaded";this.options_.container=this.options_.container?i.querySelectorAll(this.options_.container):false;this.reClass_=new RegExp("(?:^|  *)"+o(this.options_.loadingClass));this.validateT_=n(this.validate_,25);this.saveWinOffsetT_=n(this.saveWinOffset_,50);this.saveWinOffset_();this.initialize_()}t.prototype.revalidate=function(){this.initialize_()};t.prototype.validate=function(){this.validate_()};t.prototype.load=function(t){if(!this.isElementLoading_(t)&&!this.isElementLoaded_(t)){this.loadImage_(t)}};t.prototype.destroy=function(){var t,s,i;if(this.options_.container){for(t=0,s=container.length;t<s;t++){i=container[t];r(i,"scroll",this.validateT_)}}r(a,"scroll",this.validateT_);r(a,"resize",this.validateT_);r(a,"resize",this.saveWinOffsetT_);this.images_=[];this.destroyed_=true};t.prototype.initialize_=function(){var t,i,e;this.createImageArray_();if(this.destroyed_){this.destroyed_=false;if(this.options_.container){for(t=0,i=container.length;t<i;t++){e=container[t];s(e,"scroll",this.validateT_)}}s(a,"scroll",this.validateT_);s(a,"resize",this.validateT_);s(a,"resize",this.saveWinOffsetT_)}this.validate_()};t.prototype.validate_=function(){var t,s,i,e,o,n;i=this.images_.slice(0);for(t=e=0,n=i.length;e<n;t=e+=1){s=i[t];o=false;if(!this.isElementLoading_(s)&&(this.isElementInView_(s)||(o=this.isElementLoaded_(s)))){if(!o){this.load(s)}this.images_.splice(t--,1)}}if(this.images_.length===0){this.destroy()}};t.prototype.loadImage_=function(t){var i,e,o;if(!(t.offsetWidth>0&&t.offsetHeight>0)){return}i=t.getAttribute(this.options_.src);e=t.getAttribute(this.options_.srcset);if(i||e){o=new Image;t.removeAttribute(this.options_.src);t.removeAttribute(this.options_.srcset);t.className+=" "+this.options_.loadingClass;s(o,"error",function(s){return function(){if(s.options_.error){s.options_.error(t,"invalid")}t.className=t.className.replace(s.reClass_,function(){return" "+s.options_.errorClass+" "})}}(this));s(o,"load",function(s){return function(){if(t.nodeName.toLowerCase()==="img"){if(e){t.srcset=e}if(i){t.src=i}}else{t.style.backgroundImage="url("+i+")"}t.className=t.className.replace(s.reClass_,function(){return" "+s.options_.successClass+" "});if(s.options_.success){s.options_.success(t)}}}(this));if(e){o.srcset=e}if(i){o.src=i}}else{if(this.options_.error){this.options_.error(t,"missing")}t.className=t.className.replace(this.reClass_,function(t){return function(){return" "+t.options_.errorClass+" "}}(this))}};t.prototype.isElementInView_=function(t){var s,i,e,o,n,r;i=t.getBoundingClientRect();n=this.winWidth_+this.options_.offsetX;s=this.winHeight_+this.options_.offsetY;r=0-this.options_.offsetY;return i.left>=0&&i.right<=n&&(0<=(e=i.top)&&e<=s||r<=(o=i.bottom)&&o<=s)};t.prototype.isElementLoading_=function(t){return(" "+t.className+" ").indexOf(" "+this.options_.loadingClass+" ")>=0};t.prototype.isElementLoaded_=function(t){return(" "+t.className+" ").indexOf(" "+this.options_.successClass+" ")>=0};t.prototype.createImageArray_=function(){var t,s,e;e=i.querySelectorAll(this.options_.selector);for(t=e.length-1;t>=0;t+=-1){s=e[t];this.images_.unshift(s)}};t.prototype.saveWinOffset_=function(){this.winWidth_=a.innerWidth||i.documentElement.clientWidth;this.winHeight_=a.innerHeight||i.documentElement.clientHeight};return t}();if(typeof define==="function"&&define.amd){define(t)}else{a.BeLazy=t}}).call(this);